<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>برنامه کلاسی</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap");

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Vazirmatn", sans-serif;
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 20px;
        overflow-x: hidden;
        position: relative;
      }

      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(41, 128, 185, 0.15) 0%,
            transparent 40%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(155, 89, 182, 0.15) 0%,
            transparent 40%
          );
        z-index: -1;
      }

      .main-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 1200px;
        gap: 20px;
      }

      .schedule-wrapper {
        width: 100%;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
          inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.18);
        padding: 40px;
        position: relative;
        overflow: hidden;
        z-index: 1;
      }

      .schedule-wrapper::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.05) 50%,
          transparent 70%
        );
        transform: rotate(30deg);
        z-index: -1;
      }

      h1 {
        text-align: center;
        color: #fff;
        margin-bottom: 40px;
        font-weight: 500;
        font-size: 32px;
        letter-spacing: 1px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      h1::after {
        content: "";
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 3px;
        background: linear-gradient(
          to right,
          transparent,
          #3498db,
          transparent
        );
        border-radius: 3px;
      }

      .schedule-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 16px;
      }

      .day-header {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        font-weight: 500;
        font-size: 18px;
        padding: 20px 15px;
        position: sticky;
        right: 0;
        z-index: 20;
        width: 140px;
        min-width: 140px;
        text-align: center;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
        border-left: 1px solid rgba(255, 255, 255, 0.2);
      }

      .time-slot {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-weight: 400;
        font-size: 16px;
        padding: 20px 15px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
        transition: all 0.3s ease;
      }

      .time-slot:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .time-slot::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 3px;
        height: 100%;
        background: linear-gradient(to bottom, #3498db, #9b59b6);
        opacity: 0.7;
      }

      .class-cell {
        background: rgba(255, 255, 255, 0.05);
        padding: 4px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        border-right: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
        transition: all 0.3s ease;
        cursor: pointer;
        width: 250px;
        height: 120px;
        min-height: 120px;
        box-sizing: border-box;
        vertical-align: top;
      }

      .class-cell:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 5;
      }

      .class-cell::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(
          to right,
          transparent,
          #3498db,
          transparent
        );
        opacity: 0;
        transition: opacity 0.3s;
      }

      .class-cell:hover::after {
        opacity: 1;
      }

      .time-header-row {
        background: rgba(0, 0, 0, 0.2);
        position: sticky;
        top: 0;
        z-index: 15;
        backdrop-filter: blur(5px);
      }

      .time-header-cell {
        background: rgba(0, 0, 0, 0.3);
        color: #fff;
        font-weight: 500;
        font-size: 16px;
        padding: 20px 15px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
      }

      .time-header-cell:first-child {
        background: linear-gradient(135deg, #2c3e50, #34495e);
      }

      .day-header:first-child {
      }

      tr:last-child .day-header {
        border-bottom-right-radius: 16px;
      }

      .add-class-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.7);
        font-size: 24px;
        backdrop-filter: blur(5px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }

      .class-cell:hover .add-class-btn {
        opacity: 1;
      }

      .add-class-btn:hover {
        background: rgba(52, 152, 219, 0.3);
        transform: translate(-50%, -50%) scale(1.1);
        color: white;
      }

      .class-content {
        display: none;
        flex-direction: column;
        height: 100%;
        padding: 8px;
        gap: 4px;
      }

      .class-part {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: #fff;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        padding: 4px;
        text-align: center;
        word-break: break-word;
        line-height: 1.3;
        overflow: hidden;
      }

      .class-part.subject {
        font-weight: 500;
        font-size: 13px;
        background: rgba(52, 152, 219, 0.3);
      }

      .class-part.exam {
        background: rgba(231, 76, 60, 0.3);
      }

      .class-part.room {
        background: rgba(46, 204, 113, 0.3);
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background: linear-gradient(
          135deg,
          rgba(44, 62, 80, 0.9),
          rgba(52, 73, 94, 0.9)
        );
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
      }

      .close {
        color: #aaa;
        float: left;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
      }

      .close:hover {
        color: #fff;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #fff;
        font-weight: 400;
        font-size: 14px;
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-family: "Vazirmatn", sans-serif;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #3498db;
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
      }

      .form-group input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .submit-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", sans-serif;
        margin-top: 10px;
        position: relative;
        overflow: hidden;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .submit-btn::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
        transition: transform 0.6s;
      }

      .submit-btn:hover::after {
        transform: translateX(100%);
      }

      .delete-btn {
        position: absolute;
        top: 5px;
        left: 5px;
        background: rgba(231, 76, 60, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 5;
      }

      .class-cell.has-class:hover .delete-btn {
        opacity: 1;
      }

      .delete-btn:hover {
        background: rgba(192, 57, 43, 1);
        transform: scale(1.1);
      }

      /* استایل دکمه‌های کپی/پیست */
      .copy-paste-wrapper {
        position: absolute;
        top: 8px;
        right: 8px;
        display: flex;
        gap: 6px;
        z-index: 10;
        opacity: 0;
        transform: translateY(-5px);
        transition: all 0.3s ease;
      }
      .class-cell:hover .copy-paste-wrapper {
        opacity: 1;
        transform: translateY(0);
      }
      .copy-btn,
      .paste-btn {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 20px;
        padding: 4px 10px;
        font-size: 11px;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        font-family: "Vazirmatn", sans-serif;
        font-weight: 500;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }
      .copy-btn:hover,
      .paste-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .copy-btn:active,
      .paste-btn:active {
        transform: translateY(0);
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
      }

      .cell-overlay {
        position: absolute;
        inset: 0;
        background: rgba(30, 30, 46, 0.65);
        backdrop-filter: blur(4px);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 5;
      }
      .class-cell:hover .cell-overlay {
        opacity: 1;
        pointer-events: all;
      }

      /* دکمه‌های overlay */
      .ovl-btn {
        border: none;
        border-radius: 24px;
        padding: 6px 14px;
        font-size: 13px;
        color: #fff;
        cursor: pointer;
        transition: background 0.25s, transform 0.2s;
        font-family: "Vazirmatn", sans-serif;
        font-weight: 500;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      }
      .ovl-btn:hover {
        transform: translateY(-2px);
      }
      .ovl-btn:active {
        transform: translateY(0);
      }
      .ovl-btn.del {
        background: #e74c3c;
      }
      .ovl-btn.edit {
        background: #2ecc71;
      }
      .ovl-btn.copy {
        background: #3498db;
      }

      /* دکمه پیست فقط وقتی چیزی کپی شده */
      .paste-empty-btn {
        position: absolute;
        bottom: 8px;
        left: 8px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 16px;
        padding: 4px 10px;
        font-size: 12px;
        color: #fff;
        cursor: pointer;
        font-family: "Vazirmatn", sans-serif;
        opacity: 0;
        transform: translateY(5px);
        transition: all 0.3s ease;
      }
      .class-cell:not(.has-class):hover .paste-empty-btn {
        opacity: 1;
        transform: translateY(0);
      }

      .todo-sidebar {
        width: 100%;
        background: rgba(30, 30, 46, 0.08);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 24px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        z-index: 100;
        font-family: "Vazirmatn", sans-serif;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        max-height: 500px;
        overflow-y: auto;
      }

      .todo-sidebar::-webkit-scrollbar {
        width: 8px;
      }

      .todo-sidebar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }

      .todo-sidebar::-webkit-scrollbar-thumb {
        background: rgba(52, 152, 219, 0.5);
        border-radius: 4px;
      }

      .todo-sidebar::-webkit-scrollbar-thumb:hover {
        background: rgba(52, 152, 219, 0.7);
      }

      .todo-sidebar h2 {
        color: #fff;
        font-size: 20px;
        text-align: center;
        margin: 0 0 10px;
        font-weight: 500;
      }

      .todo-form {
        display: flex;
        gap: 8px;
      }

      .todo-form input {
        flex: 1;
        padding: 10px 14px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-family: "Vazirmatn", sans-serif;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      .todo-form input:focus {
        outline: none;
        border-color: #3498db;
        background: rgba(255, 255, 255, 0.15);
      }
      .todo-form input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .todo-form button {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 50%;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: #fff;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        padding-bottom: 2px;
      }
      .todo-form button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      #todoList {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        flex: 1;
      }

      .todo-item {
        position: relative;
        height: 120px;
        min-height: 120px;
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .todo-item:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      }

      .todo-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: all 0.3s ease;
      }

      .todo-main {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
      }

      .todo-text {
        flex: 1;
        font-size: 15px;
        color: #fff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        position: relative;
        padding-left: 30px;
        transition: color 0.3s ease;
      }

      /* انیمیشن بهبود یافته برای انجام شدن کار */
      .todo-text::after {
        content: "✓";
        position: absolute;
        left: 5px;
        top: 50%;
        transform: translateY(-50%) scale(0);
        color: #2ecc71;
        font-size: 20px;
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275),
          opacity 0.3s ease;
        opacity: 0;
        filter: none; /* تیک هرگز مات نمی‌شود */
      }

      .todo-item.done .todo-content {
        opacity: 0.5;
        filter: blur(1px);
        height: auto;
        margin: 0;
        padding: 0;
        overflow: visible;
      }

      .todo-item.done .todo-text {
        color: rgba(255, 255, 255, 0.7);
      }

      .todo-item.done .todo-text::after {
        transform: translateY(-50%) scale(1);
        opacity: 1;
        font-size: 20px;
        left: 5px;
        top: 50%;
        z-index: 10;
      }

      .todo-meta {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.6);
        text-align: left;
      }

      /* overlay دکمه‌ها */
      .todo-overlay {
        position: absolute;
        inset: 0;
        background: rgba(30, 30, 46, 0.65);
        backdrop-filter: blur(4px);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 5;
      }
      .todo-item:hover .todo-overlay {
        opacity: 1;
        pointer-events: all;
      }

      .ovl-todo {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 24px;
        padding: 6px 14px;
        font-size: 13px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", sans-serif;
        font-weight: 500;
        min-width: 80px;
        text-align: center;
      }
      .ovl-todo:hover {
        transform: translateY(-2px);
      }
      .ovl-todo.done {
        background: #2ecc71;
      }
      .ovl-todo.done:hover {
        background: #27ae60;
      }
      .ovl-todo.undone {
        background: #f1c40f; /* رنگ زرد */
      }
      .ovl-todo.undone:hover {
        background: #f39c12;
      }
      .ovl-todo.edit {
        background: #f1c40f;
      }
      .ovl-todo.delete {
        background: #e74c3c;
      }

      /* حالت ویرایش درون خطی */
      .todo-edit-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-family: "Vazirmatn", sans-serif;
        font-size: 15px;
        transition: all 0.3s ease;
        outline: none;
      }
      .todo-edit-input:focus {
        border-color: #3498db;
        background: rgba(255, 255, 255, 0.15);
      }

      .todo-edit-actions {
        display: flex;
        gap: 8px;
        margin-left: 10px;
      }

      .todo-save-btn,
      .todo-cancel-btn {
        border: none;
        border-radius: 20px;
        padding: 4px 12px;
        font-size: 12px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", sans-serif;
        font-weight: 500;
        min-width: 35px;
        text-align: center;
      }
      .todo-save-btn {
        background: #2ecc71;
      }
      .todo-save-btn:hover {
        background: #27ae60;
      }
      .todo-cancel-btn {
        background: #e74c3c;
      }
      .todo-cancel-btn:hover {
        background: #c0392b;
      }

      /* انیمیشن جذاب برای انجام تسک */
      @keyframes taskComplete {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
        }
        100% {
          transform: scale(1);
        }
      }

      .todo-item.completing {
        animation: taskComplete 0.6s ease-in-out;
      }

      @keyframes checkmarkBounce {
        0% {
          transform: translateY(-50%) scale(0) rotate(0deg);
        }
        50% {
          transform: translateY(-50%) scale(1.2) rotate(10deg);
        }
        100% {
          transform: translateY(-50%) scale(1) rotate(0deg);
        }
      }

      .todo-item.done .todo-text::after {
        animation: checkmarkBounce 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      /* افکت پیکسلی و گلیچ */
      @keyframes glitch {
        0% {
          transform: translate(0);
          filter: hue-rotate(0deg);
        }
        20% {
          transform: translate(-2px, 2px);
          filter: hue-rotate(90deg) blur(1px);
        }
        40% {
          transform: translate(-2px, -2px);
          filter: hue-rotate(180deg) blur(1px);
        }
        60% {
          transform: translate(2px, 2px);
          filter: hue-rotate(270deg) blur(1px);
        }
        80% {
          transform: translate(2px, -2px);
          filter: hue-rotate(360deg) blur(1px);
        }
        100% {
          transform: translate(0);
          filter: none;
        }
      }

      .todo-item.glitching .todo-content {
        animation: glitch 0.5s ease-in-out;
      }

      /* تاریخ و زمان شمسی */
      .datetime-display {
        background: rgba(30, 30, 46, 0.08);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 24px;
        padding: 15px 20px;
        color: #fff;
        font-family: "Vazirmatn", sans-serif;
        font-size: 14px;
        text-align: center;
        margin-top: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      /* تایمر پومودورو */
      .pomodoro-timer {
        background: rgba(30, 30, 46, 0.08);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.18);
        border-radius: 24px;
        padding: 15px 20px;
        color: #fff;
        font-family: "Vazirmatn", sans-serif;
        font-size: 14px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        margin-top: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .pomodoro-display {
        font-size: 24px;
        font-weight: 700;
        color: #3498db;
      }

      .pomodoro-mode {
        font-size: 14px;
        font-weight: 500;
        padding: 4px 12px;
        border-radius: 20px;
        background: rgba(52, 152, 219, 0.2);
      }

      .pomodoro-mode.break {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
      }

      .pomodoro-controls {
        display: flex;
        gap: 10px;
      }

      .pomodoro-btn {
        border: none;
        border-radius: 20px;
        padding: 6px 14px;
        font-size: 12px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: "Vazirmatn", sans-serif;
        font-weight: 500;
        background: rgba(52, 152, 219, 0.3);
      }
      .pomodoro-btn:hover {
        background: rgba(52, 152, 219, 0.5);
        transform: translateY(-2px);
      }

      /* آیکون نوتیفیکیشن */
      .notification-icon {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: rgba(52, 152, 219, 0.8);
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      .notification-icon:hover {
        background: rgba(52, 152, 219, 1);
        transform: scale(1.1);
      }

      .notification-icon::after {
        content: "!";
      }

      /* نوتیفیکشن بار سفارشی */
      .notification-bar {
        position: fixed;
        top: -100px;
        left: 0;
        width: 100%;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 15px 20px;
        text-align: center;
        font-family: "Vazirmatn", sans-serif;
        font-size: 16px;
        font-weight: 500;
        z-index: 2000;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        transition: top 0.5s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }

      .notification-bar.show {
        top: 0;
      }

      .notification-close {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .notification-close:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-50%) scale(1.1);
      }

      @media (max-width: 768px) {
        .main-container {
          padding: 10px;
        }

        .schedule-wrapper {
          padding: 20px;
          border-radius: 16px;
        }

        h1 {
          font-size: 24px;
          margin-bottom: 30px;
        }

        .day-header {
          width: 100px;
          min-width: 100px;
          font-size: 15px;
          padding: 15px 10px;
        }

        .time-slot {
          font-size: 14px;
          padding: 15px 10px;
        }

        .class-cell {
          width: 180px;
          height: 100px;
          min-height: 100px;
        }

        .time-header-cell {
          font-size: 14px;
          padding: 15px 10px;
        }

        .modal-content {
          padding: 20px;
        }

        .class-part {
          font-size: 11px;
        }

        .class-part.subject {
          font-size: 12px;
        }

        .todo-sidebar {
          max-height: 400px;
          padding: 15px;
        }

        .todo-item {
          height: 100px;
          min-height: 100px;
        }

        .todo-text {
          font-size: 14px;
          padding-left: 25px;
        }

        .todo-text::after {
          font-size: 18px;
        }

        .ovl-todo {
          min-width: 60px;
          padding: 4px 8px;
          font-size: 12px;
        }

        .notification-icon {
          width: 40px;
          height: 40px;
          font-size: 20px;
          top: 10px;
          right: 10px;
        }

        .notification-bar {
          font-size: 14px;
          padding: 12px 15px;
        }
      }
    </style>
  </head>
  <body>
    <!-- نوتیفیکشن بار سفارشی -->
    <div class="notification-bar" id="notificationBar">
      <span id="notificationMessage"></span>
      <button class="notification-close" id="notificationClose">×</button>
    </div>

    <!-- آیکون نوتیفیکیشن -->
    <div
      class="notification-icon"
      id="notificationIcon"
      title="نمایش یادآوری کلاس"></div>

    <div class="main-container">
      <div class="schedule-wrapper">
        <h1>برنامه کلاسی هفتگی</h1>
        <table class="schedule-table">
          <thead>
            <tr class="time-header-row">
              <th class="time-header-cell">ساعت کلاسی</th>
              <th class="time-header-cell">۷:۳۰ - ۹:۳۰</th>
              <th class="time-header-cell">۹:۳۰ - ۱۱:۳۰</th>
              <th class="time-header-cell">۱۳ - ۱۵</th>
              <th class="time-header-cell">۱۵ - ۱۷</th>
              <th class="time-header-cell">۱۸ - ۲۰</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="day-header">شنبه</td>
              <td class="class-cell" data-day="شنبه" data-time="7:30-9:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="شنبه" data-time="9:30-11:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="شنبه" data-time="13-15">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="شنبه" data-time="15-17">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="شنبه" data-time="18-20">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
            </tr>
            <tr>
              <td class="day-header">یک‌شنبه</td>
              <td class="class-cell" data-day="یک‌شنبه" data-time="7:30-9:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="یک‌شنبه" data-time="9:30-11:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="یک‌شنبه" data-time="13-15">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="یک‌شنبه" data-time="15-17">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="یک‌شنبه" data-time="18-20">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
            </tr>
            <tr>
              <td class="day-header">دوشنبه</td>
              <td class="class-cell" data-day="دوشنبه" data-time="7:30-9:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="دوشنبه" data-time="9:30-11:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="دوشنبه" data-time="13-15">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="دوشنبه" data-time="15-17">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="دوشنبه" data-time="18-20">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
            </tr>
            <tr>
              <td class="day-header">سه‌شنبه</td>
              <td class="class-cell" data-day="سه‌شنبه" data-time="7:30-9:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="سه‌شنبه" data-time="9:30-11:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="سه‌شنبه" data-time="13-15">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="سه‌شنبه" data-time="15-17">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="سه‌شنبه" data-time="18-20">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
            </tr>
            <tr>
              <td class="day-header">چهارشنبه</td>
              <td class="class-cell" data-day="چهارشنبه" data-time="7:30-9:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="چهارشنبه" data-time="9:30-11:30">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="چهارشنبه" data-time="13-15">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="چهارشنبه" data-time="15-17">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
              <td class="class-cell" data-day="چهارشنبه" data-time="18-20">
                <div class="add-class-btn">+</div>
                <div class="class-content">
                  <div class="class-part subject"></div>
                  <div class="class-part room"></div>
                  <div class="class-part exam"></div>
                </div>
                <button class="delete-btn">×</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <section class="todo-sidebar">
        <h2>لیست کارها</h2>

        <!-- فرم افزودن -->
        <form class="todo-form">
          <input
            type="text"
            id="todoInput"
            placeholder="کار جدید ..."
            required />
          <button type="submit">+</button>
        </form>

        <!-- لیست کارها -->
        <ul id="todoList"></ul>
      </section>

      <!-- تایمر پومودورو -->
      <!-- نمایش تاریخ و زمان شمسی -->
      <div>
        <div class="pomodoro-timer">
          <div class="pomodoro-mode" id="pomodoroMode">پومودورو</div>
          <div class="pomodoro-display" id="pomodoroDisplay">25:00</div>
          <div class="pomodoro-controls">
            <button class="pomodoro-btn" id="pomodoroStart">شروع</button>
            <button class="pomodoro-btn" id="pomodoroReset">تنظیم مجدد</button>
          </div>
          <div class="datetime-display" id="datetimeDisplay"></div>
        </div>
      </div>
    </div>

    <!-- Modal for adding class -->
    <div id="classModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 style="color: #fff; margin-bottom: 20px; text-align: center">
          افزودن درس
        </h2>
        <form id="classForm">
          <div class="form-group">
            <label for="subjectName">نام درس:</label>
            <input
              type="text"
              id="subjectName"
              name="subjectName"
              placeholder="مثال: ریاضیات" />
          </div>
          <div class="form-group">
            <label for="examDate">روز امتحان:</label>
            <input
              type="text"
              id="examDate"
              name="examDate"
              placeholder="مثال: ۱۵ خرداد" />
          </div>
          <div class="form-group">
            <label for="roomNumber">شماره کلاس:</label>
            <input
              type="text"
              id="roomNumber"
              name="roomNumber"
              placeholder="مثال: ۲۰۱" />
          </div>
          <button type="submit" class="submit-btn">افزودن درس</button>
        </form>
      </div>
    </div>

    <!-- اسکریپت کامل -->
    <script>
      /* ========== LocalStorage ========== */
      const STORAGE_KEY = "universityScheduleData";
      const CLIPBOARD_KEY = "universityClipboard";
      const FIRST_VISIT_KEY = "firstVisit";

      function loadFromStorage() {
        try {
          return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
        } catch {
          return {};
        }
      }
      function saveToStorage(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      /* ========== Clipboard ========== */
      let clipboard = (() => {
        try {
          return JSON.parse(localStorage.getItem(CLIPBOARD_KEY) || "null");
        } catch {
          return null;
        }
      })();
      function saveClipboard(data) {
        clipboard = data;
        localStorage.setItem(CLIPBOARD_KEY, JSON.stringify(data));
      }

      /* ========== Render ========== */
      function renderSavedClasses() {
        const saved = loadFromStorage();
        document.querySelectorAll(".class-cell").forEach((cell) => {
          const key = `${cell.dataset.day}-${cell.dataset.time}`;
          const info = saved[key];
          if (info?.subject) fillCell(cell, info.subject, info.exam, info.room);
        });
      }

      /* ========== Cell Fill / Clear ========== */
      function fillCell(cell, subject, exam, room) {
        cell.querySelector(".subject").textContent = subject;
        cell.querySelector(".exam").textContent = `امتحان: ${exam}`;
        cell.querySelector(".room").textContent = `کلاس: ${room}`;
        cell.querySelector(".class-content").style.display = "flex";
        cell.querySelector(".add-class-btn").style.display = "none";
        cell.classList.add("has-class");
        makeDraggable(cell);
        addOverlay(cell);
        updateNotificationIconVisibility();
      }
      function clearCell(cell) {
        cell.querySelector(".subject").textContent = "";
        cell.querySelector(".exam").textContent = "";
        cell.querySelector(".room").textContent = "";
        cell.querySelector(".class-content").style.display = "none";
        cell.querySelector(".add-class-btn").style.display = "flex";
        cell.classList.remove("has-class");
        cell.draggable = false;
        cell.style.height = ""; // برگشت به سایز CSS پایه
        cell.style.width = "";
        cell.style.transform = "";
        removeOverlay(cell);
        removePasteButton(cell);
        updateNotificationIconVisibility();

        // رفع باگ: اضافه کردن دکمه الصاق به سلول خالی شده
        if (clipboard) {
          addPasteButton(cell);
        }
      }

      /* ========== Overlay (حذف / ویرایش / کپی) ========== */
      function addOverlay(cell) {
        removeOverlay(cell);
        cell.querySelectorAll(".delete-btn").forEach((b) => b.remove());
        if (!cell.classList.contains("has-class")) return; // سلول خاری → هیچ overlay‌ای نمی‌خواد

        const overlay = document.createElement("div");
        overlay.className = "cell-overlay";

        const delBtn = document.createElement("button");
        delBtn.textContent = "حذف";
        delBtn.className = "ovl-btn del";
        delBtn.onclick = (e) => {
          e.stopPropagation();
          const key = `${cell.dataset.day}-${cell.dataset.time}`;
          const saved = loadFromStorage();
          delete saved[key];
          saveToStorage(saved);
          clearCell(cell);
        };

        const editBtn = document.createElement("button");
        editBtn.textContent = "ویرایش";
        editBtn.className = "ovl-btn edit";
        editBtn.onclick = (e) => {
          e.stopPropagation();
          currentCell = cell;
          const sub = cell.querySelector(".subject").textContent;
          const ex = cell
            .querySelector(".exam")
            .textContent.replace("امتحان: ", "");
          const rm = cell
            .querySelector(".room")
            .textContent.replace("کلاس: ", "");
          document.getElementById("subjectName").value = sub;
          document.getElementById("examDate").value = ex;
          document.getElementById("roomNumber").value = rm;
          // عنوان دکمه تغییر کنه
          document.querySelector(
            '#classForm button[type="submit"]'
          ).textContent = "ویرایش";
          modal.style.display = "block";
        };

        const copyBtn = document.createElement("button");
        copyBtn.textContent = "کپی";
        copyBtn.className = "ovl-btn copy";
        copyBtn.onclick = (e) => {
          e.stopPropagation();
          const sub = cell.querySelector(".subject").textContent;
          const ex = cell
            .querySelector(".exam")
            .textContent.replace("امتحان: ", "");
          const rm = cell
            .querySelector(".room")
            .textContent.replace("کلاس: ", "");
          saveClipboard({ subject: sub, exam: ex, room: rm });
          copyBtn.textContent = "✓";
          setTimeout(() => (copyBtn.textContent = "کپی"), 1000);
          // فعال‌سازی دکمه پیست در سلول‌های خالی
          document
            .querySelectorAll(".class-cell:not(.has-class)")
            .forEach(addPasteButton);
        };

        overlay.append(delBtn, editBtn, copyBtn);
        cell.append(overlay);
      }
      function removeOverlay(cell) {
        cell.querySelectorAll(".cell-overlay").forEach((o) => o.remove());
      }

      /* ========== Paste Button for Empty Cells ========== */
      function addPasteButton(cell) {
        if (cell.classList.contains("has-class")) return;
        if (cell.querySelector(".paste-empty-btn")) return;
        if (!clipboard) return;
        const pasteBtn = document.createElement("button");
        pasteBtn.textContent = "الصاق";
        pasteBtn.className = "paste-empty-btn";
        pasteBtn.onclick = (e) => {
          e.stopPropagation();
          fillCell(cell, clipboard.subject, clipboard.exam, clipboard.room);
          const key = `${cell.dataset.day}-${cell.dataset.time}`;
          const saved = loadFromStorage();
          saved[key] = { ...clipboard };
          saveToStorage(saved);
        };
        cell.append(pasteBtn);
      }
      function removePasteButton(cell) {
        cell.querySelectorAll(".paste-empty-btn").forEach((b) => b.remove());
      }

      /* ========== Modal ========== */
      let currentCell = null;
      const modal = document.getElementById("classModal");
      const form = document.getElementById("classForm");
      const submitBtn = form.querySelector('button[type="submit"]');
      const closeModal = () => {
        modal.style.display = "none";
        form.reset();
        submitBtn.textContent = "افزودن درس"; // برگشتن به حالت پیش‌فرض
      };
      document.querySelector(".close").onclick = closeModal;
      window.onclick = (e) => {
        if (e.target === modal) closeModal();
      };

      /* Add class */
      document.querySelectorAll(".add-class-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          currentCell = btn.closest(".class-cell");
          submitBtn.textContent = "افزودن درس";
          modal.style.display = "block";
        });
      });
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        if (!currentCell) return;
        const subject = form.subjectName.value.trim();
        const exam = form.examDate.value.trim();
        const room = form.roomNumber.value.trim();
        if (subject && exam && room) {
          fillCell(currentCell, subject, exam, room);
          const key = `${currentCell.dataset.day}-${currentCell.dataset.time}`;
          const saved = loadFromStorage();
          saved[key] = { subject, exam, room };
          saveToStorage(saved);
          closeModal();
        }
      });

      /* ========== Drag & Drop ========== */
      function makeDraggable(cell) {
        cell.draggable = true;
        cell.addEventListener("dragstart", (e) => {
          const key = `${cell.dataset.day}-${cell.dataset.time}`;
          e.dataTransfer.effectAllowed = "move";
          e.dataTransfer.setData("text/plain", key);
          cell.style.opacity = "0.4";
        });
        cell.addEventListener("dragend", () => (cell.style.opacity = ""));
      }
      document.querySelectorAll(".class-cell").forEach((target) => {
        target.addEventListener("dragover", (e) => {
          if (target.classList.contains("class-cell")) {
            e.preventDefault();
            target.style.background = "rgba(52,152,219,0.3)";
          }
        });
        target.addEventListener(
          "dragleave",
          () => (target.style.background = "")
        );
        target.addEventListener("drop", (e) => {
          e.preventDefault();
          target.style.background = "";
          const srcKey = e.dataTransfer.getData("text/plain");
          const srcCell = document.querySelector(
            `[data-day="${srcKey.split("-")[0]}"][data-time="${srcKey
              .split("-")
              .slice(1)
              .join("-")}"]`
          );
          if (!srcCell || srcCell === target) return;

          const saved = loadFromStorage();
          const data = saved[srcKey];
          if (!data) return;

          delete saved[srcKey];
          clearCell(srcCell);
          const dstKey = `${target.dataset.day}-${target.dataset.time}`;
          saved[dstKey] = data;
          fillCell(target, data.subject, data.exam, data.room);
          saveToStorage(saved);

          updateNotificationIconVisibility();
        });
      });

      /* ========== Hover FX ========== */
      document.querySelectorAll(".class-cell").forEach((c) => {
        c.addEventListener(
          "mouseenter",
          () => (c.style.transform = "translateY(-2px)")
        );
        c.addEventListener(
          "mouseleave",
          () => (c.style.transform = "translateY(0)")
        );
      });

      /* ========== Init ========== */
      renderSavedClasses();
      document.querySelectorAll(".class-cell").forEach((c) => {
        addOverlay(c);
        addPasteButton(c);
      });

      const todoForm = document.querySelector(".todo-form");
      const todoInput = document.getElementById("todoInput");
      const todoList = document.getElementById("todoList");
      const TODO_KEY = "todoList";

      let todos = JSON.parse(localStorage.getItem(TODO_KEY) || "[]");
      let currentEditIndex = -1;

      function saveTodos() {
        localStorage.setItem(TODO_KEY, JSON.stringify(todos));
      }

      function formatDateTime() {
        const now = new Date();
        const options = { weekday: "long", hour: "2-digit", minute: "2-digit" };
        const persianDate = now.toLocaleDateString("fa-IR", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
        const timeStr = now.toLocaleTimeString("fa-IR", options);
        return `${persianDate} - ${timeStr}`;
      }

      function renderTodos() {
        todoList.innerHTML = "";
        todos.forEach((todo, index) => {
          const li = document.createElement("li");
          li.className = "todo-item" + (todo.done ? " done" : "");

          // اگر در حالت ویرایش باشد
          if (currentEditIndex === index) {
            li.innerHTML = `
              <div class="todo-content">
                <div class="todo-main">
                  <div class="todo-edit-actions">
                    <button class="todo-save-btn">✓</button>
                    <button class="todo-cancel-btn">×</button>
                  </div>
                  <input type="text" class="todo-edit-input" value="${
                    todo.text
                  }" />
                </div>
                <div class="todo-meta">${todo.addedDate || ""}</div>
              </div>
            `;

            // فوکوس روی اینپوت و انتخاب متن
            const input = li.querySelector(".todo-edit-input");
            input.focus();
            input.select();

            // رویداد ذخیره
            li.querySelector(".todo-save-btn").onclick = () => {
              const newText = input.value.trim();
              if (newText) {
                todos[index].text = newText;
                saveTodos();
              }
              currentEditIndex = -1;
              renderTodos();
            };

            // رویداد انصراف
            li.querySelector(".todo-cancel-btn").onclick = () => {
              currentEditIndex = -1;
              renderTodos();
            };

            // رویداد Enter برای ذخیره
            input.addEventListener("keydown", (e) => {
              if (e.key === "Enter") {
                li.querySelector(".todo-save-btn").click();
              } else if (e.key === "Escape") {
                li.querySelector(".todo-cancel-btn").click();
              }
            });
          } else {
            // حالت نمایش عادی
            li.innerHTML = `
              <div class="todo-content">
                <div class="todo-main">
                  <span class="todo-text" title="${todo.text}">${
              todo.text
            }</span>
                </div>
                <div class="todo-meta">${todo.addedDate || ""}</div>
              </div>
              <div class="todo-overlay">
                <button class="ovl-todo ${
                  todo.done ? "undone" : "done"
                }" title="${todo.done ? "انجام نشد" : "انجام شد"}">${
              todo.done ? "↶" : "✓"
            }</button>
                ${
                  !todo.done
                    ? '<button class="ovl-todo edit" title="ویرایش">&#9998;</button>'
                    : ""
                }
                <button class="ovl-todo delete" title="حذف">&times;</button>
              </div>
            `;

            const txt = li.querySelector(".todo-text");
            const doneBtn = li.querySelector(
              ".ovl-todo.done, .ovl-todo.undone"
            );
            const editBtn = li.querySelector(".ovl-todo.edit");
            const delBtn = li.querySelector(".ovl-todo.delete");

            txt.onclick = () => {
              todo.done = !todo.done;
              li.classList.toggle("done");

              // اضافه کردن انیمیشن جذاب
              if (todo.done) {
                li.classList.add("glitching");
                setTimeout(() => {
                  li.classList.remove("glitching");
                }, 500);
              }

              saveTodos();
              renderTodos();
            };

            doneBtn.onclick = () => {
              todo.done = !todo.done;
              li.classList.toggle("done");

              // اضافه کردن انیمیشن جذاب
              if (todo.done) {
                li.classList.add("glitching");
                setTimeout(() => {
                  li.classList.remove("glitching");
                }, 500);
              }

              saveTodos();
              renderTodos();
            };

            if (editBtn) {
              editBtn.onclick = () => {
                currentEditIndex = index;
                renderTodos();
              };
            }

            delBtn.onclick = () => {
              if (confirm("حذف شود؟")) {
                todos.splice(index, 1);
                saveTodos();
                renderTodos();
              }
            };
          }

          todoList.appendChild(li);
        });
      }

      todoForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const text = todoInput.value.trim();
        if (!text) return;
        todos.push({ text, done: false, addedDate: formatDateTime() });
        saveTodos();
        renderTodos();
        todoInput.value = "";
      });

      renderTodos();

      /* ========== تاریخ و زمان شمسی ========== */
      function updateDateTime() {
        const now = new Date();
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          weekday: "long",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        };
        const persianDateTime = now.toLocaleDateString("fa-IR", options);
        document.getElementById("datetimeDisplay").textContent =
          persianDateTime;
      }

      // به‌روزرسانی تاریخ و زمان هر ثانیه
      updateDateTime();
      setInterval(updateDateTime, 1000);

      /* ========== تایمر پومودورو ========== */
      let pomodoroInterval = null;
      let pomodoroTimeLeft = 25 * 60; // 25 دقیقه به ثانیه
      let pomodoroMode = "work"; // 'work' یا 'break'
      let pomodoroRunning = false;

      const pomodoroDisplay = document.getElementById("pomodoroDisplay");
      const pomodoroModeDisplay = document.getElementById("pomodoroMode");
      const pomodoroStartBtn = document.getElementById("pomodoroStart");
      const pomodoroResetBtn = document.getElementById("pomodoroReset");

      function updatePomodoroDisplay() {
        const minutes = Math.floor(pomodoroTimeLeft / 60);
        const seconds = pomodoroTimeLeft % 60;
        pomodoroDisplay.textContent = `${minutes
          .toString()
          .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
      }

      function startPomodoro() {
        if (pomodoroRunning) return;

        pomodoroRunning = true;
        pomodoroStartBtn.textContent = "توقف";

        pomodoroInterval = setInterval(() => {
          pomodoroTimeLeft--;
          updatePomodoroDisplay();

          if (pomodoroTimeLeft <= 0) {
            clearInterval(pomodoroInterval);
            pomodoroRunning = false;
            pomodoroStartBtn.textContent = "شروع";

            // تغییر حالت
            if (pomodoroMode === "work") {
              pomodoroMode = "break";
              pomodoroTimeLeft = 5 * 60; // 5 دقیقه استراحت
              pomodoroModeDisplay.textContent = "استراحت";
              pomodoroModeDisplay.classList.add("break");

              // نمایش نوتیفیکیشن
              showNotification("زمان استراحت!", "۵ دقیقه استراحت کنید");
            } else {
              pomodoroMode = "work";
              pomodoroTimeLeft = 25 * 60; // 25 دقیقه کار
              pomodoroModeDisplay.textContent = "کار";
              pomodoroModeDisplay.classList.remove("break");

              // نمایش نوتیفیکیشن
              showNotification("زمان کار!", "زمان شروع دور بعدی کار است");
            }

            updatePomodoroDisplay();
          }
        }, 1000);
      }

      function stopPomodoro() {
        if (!pomodoroRunning) return;

        clearInterval(pomodoroInterval);
        pomodoroRunning = false;
        pomodoroStartBtn.textContent = "شروع";
      }

      function resetPomodoro() {
        stopPomodoro();
        pomodoroMode = "work";
        pomodoroTimeLeft = 25 * 60;
        pomodoroModeDisplay.textContent = "کار";
        pomodoroModeDisplay.classList.remove("break");
        updatePomodoroDisplay();
      }

      // رویدادهای دکمه‌های پومودورو
      pomodoroStartBtn.addEventListener("click", () => {
        if (pomodoroRunning) {
          stopPomodoro();
        } else {
          startPomodoro();
        }
      });

      pomodoroResetBtn.addEventListener("click", resetPomodoro);

      // مقداردهی اولیه
      updatePomodoroDisplay();

      /* ========== نوتیفیکشن سفارشی ========== */
      const notificationBar = document.getElementById("notificationBar");
      const notificationMessage = document.getElementById(
        "notificationMessage"
      );
      const notificationClose = document.getElementById("notificationClose");

      function showNotification(title, message) {
        notificationMessage.textContent = `${title}: ${message}`;
        notificationBar.classList.add("show");

        // بستن خودکار بعد از 5 ثانیه
        setTimeout(() => {
          notificationBar.classList.remove("show");
        }, 5000);
      }

      // بستن نوتیفیکشن با کلیک روی دکمه بستن
      notificationClose.addEventListener("click", () => {
        notificationBar.classList.remove("show");
      });

      /* ========== نوتیفیکشن کلاس ========== */
      // تابع برای دریافت زمان فعلی و بازه زمانی
      function getCurrentTimeSlot() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const currentTime = hours * 60 + minutes; // زمان به دقیقه

        // بازه‌های زمانی به دقیقه
        const timeSlots = {
          "7:30-9:30": { start: 7 * 60 + 30, end: 9 * 60 + 30 },
          "9:30-11:30": { start: 9 * 60 + 30, end: 11 * 60 + 30 },
          "13-15": { start: 13 * 60, end: 15 * 60 },
          "15-17": { start: 15 * 60, end: 17 * 60 },
          "18-20": { start: 18 * 60, end: 20 * 60 },
        };

        for (const [slot, times] of Object.entries(timeSlots)) {
          if (currentTime >= times.start && currentTime < times.end) {
            return slot;
          }
        }

        return null; // خارج از بازه‌های زمانی
      }

      // تابع برای دریافت روز هفته به فارسی
      function getPersianDay() {
        const days = [
          "یک‌شنبه",
          "دوشنبه",
          "سه‌شنبه",
          "چهارشنبه",
          "پنج‌شنبه",
          "جمعه",
          "شنبه",
        ];
        const dayIndex = new Date().getDay();
        // در جاوا اسکریپت، روز 0 یکشنبه است و روز 6 شنبه است
        // ما باید این را به ترتیب روزهای فارسی تبدیل کنیم
        return days[dayIndex];
      }

      // تابع برای بررسی وجود کلاس در زمان فعلی
      function hasClassInCurrentTimeSlot() {
        const currentDay = getPersianDay();
        const currentTimeSlot = getCurrentTimeSlot();

        if (!currentTimeSlot) {
          return false; // خارج از بازه‌های زمانی
        }

        const saved = loadFromStorage();
        const classKey = `${currentDay}-${currentTimeSlot}`;
        const classInfo = saved[classKey];

        return !!(classInfo && classInfo.subject); // اگر کلاسی وجود داشته باشد true برگردان
      }

      // تابع برای به‌روزرسانی وضعیت آیکون نوتیفیکیشن
      function updateNotificationIconVisibility() {
        const notificationIcon = document.getElementById("notificationIcon");
        if (hasClassInCurrentTimeSlot()) {
          notificationIcon.style.display = "flex";
        } else {
          notificationIcon.style.display = "none";
        }
      }
      // تابع برای نمایش نوتیفیکیشن کلاس
      function showClassNotification() {
        if (!hasClassInCurrentTimeSlot()) {
          return; // اگر کلاسی وجود نداشته باشد، کاری نکن
        }

        const currentDay = getPersianDay();
        const currentTimeSlot = getCurrentTimeSlot();
        const saved = loadFromStorage();
        const classKey = `${currentDay}-${currentTimeSlot}`;
        const classInfo = saved[classKey];

        if (classInfo && classInfo.subject) {
          showNotification(
            "یادآوری کلاس",
            `شما کلاس ${classInfo.subject} در کلاس ${classInfo.room} دارید`
          );
        }
      }

      // رویداد کلیک روی آیکون نوتیفیکیشن
      document
        .getElementById("notificationIcon")
        .addEventListener("click", () => {
          showClassNotification();
        });

      // بررسی اولین ورود کاربر
      window.addEventListener("load", () => {
        const firstVisit = localStorage.getItem(FIRST_VISIT_KEY);

        if (!firstVisit) {
          // اولین بار ورود کاربر
          localStorage.setItem(FIRST_VISIT_KEY, "true");

          // نمایش نوتیفیکیشن بعد از 2 ثانیه
          setTimeout(() => {
            showClassNotification();
          }, 2000);
        }

        // به‌روزرسانی وضعیت آیکون در بارگذاری صفحه
        updateNotificationIconVisibility();
        // چک کردن خودکار نوتیفیکیشن هر دقیقه
        setInterval(() => {
          showClassNotification();
        }, 60000);

        // برای بارگذاری اولیه هم یکبار چک کن
        showClassNotification();

        // به‌روزرسانی وضعیت آیکون هر دقیقه
        setInterval(updateNotificationIconVisibility, 60000);
      });
    </script>
  </body>
</html>
